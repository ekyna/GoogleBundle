<?xml version="1.0" encoding="UTF-8" ?>
<container
    xmlns="http://symfony.com/schema/dic/services"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://symfony.com/schema/dic/services
                        http://symfony.com/schema/dic/services/services-1.0.xsd">

    <services>

        <!-- Google client -->
        <service id="ekyna_google.client" class="Ekyna\Bundle\GoogleBundle\GoogleClient">
            <argument type="collection"/><!-- Replace d by DI extension -->
        </service>

        <!-- Form types -->
        <service id="ekyna_google.coordinate.form_type" class="Ekyna\Bundle\GoogleBundle\Form\Type\CoordinateType">
            <tag name="form.type" />
            <tag name="form.js" selector=".ekyna-google-coordinate" path="ekyna-form/google-coordinate" />
        </service>

        <!-- Show types -->
        <service id="ekyna_google.show.google_map_type"
                 class="Ekyna\Bundle\GoogleBundle\Show\Type\GoogleMapType">
            <tag name="ekyna_admin.show.type" alias="google_map"/>
        </service>

        <!-- Settings Schema -->
        <service id="ekyna_google.settings" class="Ekyna\Bundle\GoogleBundle\Settings\Schema">
            <tag name="ekyna_setting.schema" namespace="google" position="90" />
        </service>

        <!-- Map pool -->
        <service id="ekyna_google.map.pool" class="Ekyna\Bundle\GoogleBundle\Map\MapPool"/>

        <!-- Tracking pool -->
        <service id="ekyna_google.tracking.pool" class="Ekyna\Bundle\GoogleBundle\Tracking\TrackingPool"/>

        <!-- Tracking renderer -->
        <service id="ekyna_google.tracking.renderer" class="Ekyna\Bundle\GoogleBundle\Tracking\TrackingRenderer">
            <argument type="service" id="Twig\Environment"/>
            <argument type="service" id="Symfony\Component\HttpFoundation\RequestStack"/>
            <argument type="service" id="ekyna_setting.manager"/>
            <argument type="service" id="Ekyna\Bundle\CookieConsentBundle\Service\Manager"/>
            <argument type="service" id="ekyna_google.tracking.pool"/>
            <argument type="collection"/><!-- Replace d by DI extension -->
        </service>

        <!-- Modal event listener -->
        <service id="ekyna_google.event_listener.modal"
                 class="Ekyna\Bundle\GoogleBundle\EventListener\ModalEventSubscriber">
            <argument type="service" id="ekyna_google.tracking.renderer"/>
            <tag name="kernel.event_subscriber"/>
        </service>

        <!-- Twig Extensions -->
        <service id="ekyna_google.twig.tracking_extension" class="Ekyna\Bundle\GoogleBundle\Twig\TrackingExtension">
            <argument type="service" id="ekyna_google.tracking.renderer" />
            <tag name="twig.extension" />
        </service>

    </services>

</container>
